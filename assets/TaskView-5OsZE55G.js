import{r as i,P as T,h as L,Q as V,w as A,j as e}from"./index-DmENW6B2.js";import{y as m,C as o,L as M,g as P,f as U}from"./index-fVCei9CP.js";import"./index-CugqLUv5.js";import{z as n,u as k,F as v,a as d,C as p,I as N,B as D,t as z}from"./index-BeOvlGq0.js";import{R as S}from"./FileItem-i_5a3kv3.js";import"./index-IEdz60AJ.js";import{p as G}from"./index-CsPxhSsc.js";import"./CloseButton-DKk2w9LK.js";import"./floating-ui.dom-CV1Qg3mg.js";const Z=()=>{var j,g;const[r,y]=i.useState(),c=T(),w=n.object({option:n.number({message:"Выберите значение"}),inputs:n.record(n.string({message:"Введите ответ"})),reason:n.string({message:"Заполните поле"})}),{handleSubmit:B,formState:{errors:a},control:l,reset:C}=k({defaultValues:{inputs:{}},resolver:z(w)}),[h,x]=i.useState(!0),u=L(s=>s.user);i.useEffect(()=>{(r==null?void 0:r.visible)==="PRIVATE"&&!u.id?x(!1):x(!0)},[r,u.id]),i.useEffect(()=>{(async()=>{if(c.label)try{const t=await P(decodeURIComponent(c.label));y(t)}catch(t){console.error("Ошибка при получении данных:",t)}})().catch(t=>{console.error(t),m.error("Ошибка получения задачи")})},[c.label]);const F=async s=>{try{await U({reason:s==null?void 0:s.reason,optionId:s==null?void 0:s.option,inputs:s.inputs},r==null?void 0:r.id.toString()),C({inputs:{}}),m.success("Данные успешно отправлены")}catch(t){console.error(t),m.error("Ошибка выполнения запроса")}},I=V(),E=A({"m-auto":/view-task-public/.test(I.pathname),"w-3/4":!0});return e.jsxs(e.Fragment,{children:[!h&&e.jsx(o,{children:e.jsx("h5",{children:"Доступ закрыт, необходимо авторизироваться!"})}),r&&h&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:E,children:[e.jsx("h3",{className:"h3 mb-5",children:"Задание"}),e.jsx(o,{header:{content:r==null?void 0:r.label},children:e.jsx("div",{className:"mt-2",children:G(r.description)})}),e.jsxs(v,{onSubmit:B(F),children:[e.jsxs(o,{className:"mt-5",header:{content:"Опции"},children:[e.jsx(d,{asterisk:!0,label:"Выбирите вариант",className:"mb-0",invalid:!!a.option,errorMessage:(j=a.option)==null?void 0:j.message,children:e.jsx(p,{name:"option",control:l,render:({field:s})=>e.jsx(S.Group,{vertical:!0,...s,children:r==null?void 0:r.options.map(t=>e.jsx(S,{value:t.id,children:e.jsxs(o,{header:{content:t.label},children:[e.jsx("p",{className:"mb-4",children:t.description}),e.jsx("img",{className:"task-vote-img",src:t.imageUrl,alt:""})]},t.id)},t.id))})})}),e.jsx(d,{className:"mt-7 mb-1",label:"Причина выбора опции",invalid:!!a.reason,errorMessage:(g=a.reason)==null?void 0:g.message,children:e.jsx(p,{name:"reason",control:l,render:({field:s})=>e.jsx(N,{type:"text",placeholder:"Напишите причину выбора",...s})})})]}),r.inputs.length>0&&e.jsx(o,{className:"mt-5",header:{content:"Дополнительные вопросы"},children:r.inputs.map(s=>{var t,b,f;return e.jsx(d,{label:s.label,invalid:!!((t=a.inputs)!=null&&t[s.id]),errorMessage:(f=(b=a.inputs)==null?void 0:b[s.id])==null?void 0:f.message,children:e.jsx(p,{name:`inputs.${s.id.toString()}`,control:l,render:({field:R})=>e.jsx(N,{...R,type:"text",placeholder:"Введите ваш ответ"})},s.id)})})}),e.jsx(D,{className:"mt-5",type:"submit",children:"Отправить"})]})]})}),e.jsx(M,{})]})};export{Z as default};
